# End-to-end testing

ToolHive’s E2E suite uses Playwright to run the packaged Electron app. Tests are
executed against the prebuilt app in `out/`, mirroring real user flows end to
end.

## Prerequisites

- `pnpm install`
- A built app in `out/` (generated by `pnpm package` or `pnpm e2e`)
- Ollama running locally (default: `http://localhost:11434`)

## Run the suite

- Full build + tests:
  - `pnpm run e2e`
- Tests only (reuse `out/`):
  - `pnpm run e2e:prebuilt`

## Coverage

### MCP registry installs

- **Tested**: install/uninstall a server from the registry.
- **Notes**: focuses on the happy path; the registry list is not exhaustively
  validated.

### Remote MCP servers + tool calling

- **Tested**: add a remote MCP server, enable its tools, and verify the model
  calls a test tool in the Playground.
- **Notes**: uses a local mock MCP server to avoid external dependencies.

### Secrets

- **Tested**: create and delete a secret through the UI.
- **Notes**: only validates CRUD; does not assert secrets inside server runtime.

### Settings

- **Tested**: version tab shows the ToolHive binary version.
- **Notes**: other settings are covered by unit tests or manual QA.

## Test isolation

Test isolation is imperfect because the app stores state on disk and runs real
workloads. We mitigate this by creating a dedicated test group and cleaning it
up via the `thv` CLI before and after each run. Some state (like local caches)
may still persist across runs.

## Limitations

- E2E runs only on GitHub Actions Linux runners for performance. macOS and
  Windows runners are significantly slower and are not part of the default
  E2E matrix.
- Tests focus on daily user interactions (full end-to-end flows with backend
  services and Playground). We do not cover OS-specific install/uninstall flows,
  auto-updates, or platform-dependent behaviors.
- Features that rely on native OS dialogs (such as file pickers) are not fully
  tested without mocks.
- Scenarios are happy-path oriented; destructive cases and edge-case matrices are
  intentionally handled elsewhere to keep E2E runtime manageable.
- Feature-specific constraints are documented in each section above.

## Troubleshooting

- CI artifacts (screenshots, traces, videos) are attached to GitHub Actions
  runs. See GitHub’s documentation for downloading artifacts:
  - https://docs.github.com/en/actions/managing-workflow-runs/downloading-workflow-artifacts
- For local UI debugging, use Playwright’s tracing or set `PWDEBUG=1`.
